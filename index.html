<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>CivicConnect — Simple Prototype</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />

<style>
:root{--bg:#0f172a;--card:#071428;--accent:#1e88e5;--muted:#9aa4b2;--surface:#071428}
:root.light{--bg:#f7f9fc;--card:#ffffff;--accent:#1565c0;--muted:#57636a;--surface:#ffffff;color-scheme:light}

*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;background:var(--bg);color:var(--muted);}
body{display:flex;flex-direction:column;}

/* Splash */
.splash{position:fixed;inset:0;background:linear-gradient(180deg,var(--card),#06202a);display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:9999}
.splash .biglogo{width:140px;height:140px;border-radius:20px;background:linear-gradient(135deg,var(--accent),#00bfa5);display:flex;align-items:center;justify-content:center;font-weight:900;color:white;font-size:40px;box-shadow:0 12px 40px rgba(2,6,23,0.6);}
.splash small{color:var(--muted);margin-top:12px;}
.splash .chip{margin-top:18px;padding:6px 12px;border-radius:999px;border:1px solid rgba(255,255,255,0.2);cursor:pointer;transition:0.2s;}
.splash .chip:hover{background:var(--accent);color:white;}

/* Appbar */
header.appbar{display:flex;align-items:center;gap:12px;padding:12px 16px;background:linear-gradient(90deg,var(--card),#06202a);backdrop-filter:blur(6px);}
header .title{font-weight:700;font-size:16px;color:var(--text,#e6eef8)}
header .subtitle{font-size:12px;color:var(--muted)}
.right-actions{margin-left:auto;display:flex;gap:8px;align-items:center}
.chip{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 10px;border-radius:999px;color:var(--muted);font-size:13px;cursor:pointer;transition:0.2s;}
.chip:hover{background:var(--accent);color:white;}

/* Main */
main{flex:1;display:flex;flex-direction:column;overflow-y:auto;padding:12px;gap:12px}
.card{background:var(--card);border-radius:14px;padding:12px;border:1px solid rgba(255,255,255,0.03);transition:0.2s;cursor:pointer;}
.card:hover{background:rgba(30,136,229,0.1);}
input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
textarea{min-height:100px}

/* Map */
#map{height:45vh;border-radius:12px;overflow:hidden}

/* Bottom Nav */
nav.bottom{position:fixed;left:12px;right:12px;bottom:12px;background:var(--card);padding:8px;border-radius:14px;display:flex;justify-content:space-around;align-items:center;gap:8px;border:1px solid rgba(255,255,255,0.04);}
nav button{background:transparent;border:none;color:var(--muted);font-size:13px;display:flex;flex-direction:column;align-items:center;gap:4px;padding:6px 8px;border-radius:10px;cursor:pointer;transition:0.2s;}
nav button.active{color:var(--accent);font-weight:600;}
nav button:hover{background:rgba(30,136,229,0.1);}

/* Panels */
.panel{display:none;flex-direction:column;gap:10px;}
.panel.active{display:flex;}

/* FAB */
.fab{position:fixed;right:24px;bottom:86px;background:linear-gradient(135deg,var(--accent),#00bfa5);color:white;border:none;padding:14px;border-radius:999px;box-shadow:0 8px 30px rgba(30,136,229,0.18);font-size:18px;cursor:pointer;transition:0.2s;}
.fab:hover{transform:scale(1.05);}

/* Modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.6);display:none;align-items:center;justify-content:center;padding:16px;z-index:40}
.modal{width:100%;max-width:480px;background:var(--card);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}

.small{font-size:12px;color:var(--muted)}
.issue{display:flex;gap:10px;background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);}
.issue img{width:64px;height:64px;object-fit:cover;border-radius:8px}
.issue .right{flex:1;}
</style>
</head>
<body>

<!-- Splash -->
<div class="splash" id="splash">
  <div class="biglogo" id="bigLogo">CC</div>
  <small>Welcome to CivicConnect — loading…</small>
  <div><div id="skipSplash" class="chip">Skip</div></div>
</div>

<header class="appbar">
  <div>
    <div class="title">CivicConnect</div>
    <div class="subtitle small">Report & track local civic issues</div>
  </div>
  <div class="right-actions">
    <div id="themeToggle" class="chip">Dark</div>
  </div>
</header>

<main>
  <!-- Home Panel -->
  <div class="panel active" id="homePanel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:700">Nearby Reports</div>
      <div class="small" id="countLabel">0 reports</div>
    </div>
    <div id="map"></div>
  </div>

  <!-- Report Panel -->
  <div class="panel" id="reportPanel">
    <div class="card">
      <div style="font-weight:700;margin-bottom:8px">New Report</div>
      <input id="rTitle" placeholder="Title" />
      <select id="rCategory">
        <option value="pothole">Pothole</option>
        <option value="streetlight">Streetlight</option>
        <option value="garbage">Garbage</option>
        <option value="other">Other</option>
      </select>
      <textarea id="rDesc" placeholder="Describe the issue"></textarea>
      <input type="file" id="rPhoto" accept="image/*" />
      <div class="chip" id="locText">Detecting location…</div>
      <div style="margin-top:12px;text-align:right">
        <button class="chip" id="submitReportBtn">Submit</button>
      </div>
    </div>
  </div>

  <!-- List Panel -->
  <div class="panel" id="listPanel"></div>

  <!-- Profile Panel -->
  <div class="panel" id="profilePanel">
    <div class="card">
      <div style="font-weight:700;margin-bottom:8px">Profile</div>
      <div>Name: Guest</div>
      <div>Reports: <span id="reportCount">0</span></div>
      <div>Upvotes: <span id="upvoteCount">0</span></div>
    </div>
  </div>
</main>

<nav class="bottom" role="navigation">
  <button id="navHome" class="active"><span class="material-icons">map</span><span>Home</span></button>
  <button id="navReport"><span class="material-icons">add_circle</span><span>Report</span></button>
  <button id="navList"><span class="material-icons">format_list_bulleted</span><span>List</span></button>
  <button id="navProfile"><span class="material-icons">person</span><span>Profile</span></button>
</nav>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const $ = id => document.getElementById(id);

// Splash
const splash = $('splash'), skipSplash = $('skipSplash');
function hideSplash(){ splash.style.display='none'; }
skipSplash.addEventListener('click', hideSplash);
setTimeout(hideSplash,1500);

// Theme
const root = document.documentElement, themeToggle = $('themeToggle');
function setTheme(dark){ if(dark) root.classList.remove('light'); else root.classList.add('light'); themeToggle.textContent = dark?'Dark':'Light'; }
const savedTheme = localStorage.getItem('civic_theme'); setTheme(savedTheme!=='light');
themeToggle.addEventListener('click', ()=>{ const cur = localStorage.getItem('civic_theme')==='light'; localStorage.setItem('civic_theme', cur?'dark':'light'); setTheme(!cur); });

// Map
const MAP_CENTER=[28.7041,77.1025];
const map = L.map('map',{zoomControl:false}).setView(MAP_CENTER,13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
L.control.zoom({position:'topright'}).addTo(map);
let markerLayer = L.layerGroup().addTo(map);

// Location
function setLocationText(lat,lng){ $('locText').textContent = `${lat.toFixed(5)}, ${lng.toFixed(5)}`; $('locText').dataset.lat=lat; $('locText').dataset.lng=lng; }
if(navigator.geolocation){ navigator.geolocation.getCurrentPosition(p=>{ setLocationText(p.coords.latitude,p.coords.longitude); map.setView([p.coords.latitude,p.coords.longitude],14); },()=>{ setLocationText(MAP_CENTER[0],MAP_CENTER[1]); }); }

// Storage
const storageKey='civic_reports';
function loadReports(){ try{return JSON.parse(localStorage.getItem(storageKey))||[];}catch(e){return [];} }
function saveReports(rs){ localStorage.setItem(storageKey,JSON.stringify(rs)); }

// Render
function renderAll(){
  const reports=loadReports();
  markerLayer.clearLayers();
  const countLabel=$('countLabel');
  countLabel.textContent=reports.length+' reports';
  reports.forEach(r=>{
    const m=L.marker([r.lat,r.lng]).addTo(markerLayer);
    m.bindPopup(`<b>${r.title}</b><br>${r.category} • ${r.status}`);
  });
  $('reportCount').textContent=reports.length;
  let upvotesTotal=0; reports.forEach(r=>upvotesTotal+=r.votes||0);
  $('upvoteCount').textContent=upvotesTotal;
  buildListPanel();
}

// UID
function uid(){ return 'r_'+Date.now()+'_'+Math.random().toString(36).slice(2,7); }

// Submit Report
$('submitReportBtn').addEventListener('click', ()=>{
  const title=$('rTitle').value.trim(), desc=$('rDesc').value.trim();
  const cat=$('rCategory').value, lat=parseFloat($('locText').dataset.lat||MAP_CENTER[0]);
  const lng=parseFloat($('locText').dataset.lng||MAP_CENTER[1]);
  if(!title){ alert('Add title'); return; }
  const id=uid();
  const file=$('rPhoto').files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=e=>{
      const photo=e.target.result;
      const obj={id,title,desc,category:cat,lat,lng,photo,status:'Pending',votes:0,comments:[],created:Date.now()};
      const reports=loadReports(); reports.push(obj); saveReports(reports); renderAll();
      $('rTitle').value=''; $('rDesc').value=''; $('rPhoto').value=''; alert('Report submitted');
    };
    reader.readAsDataURL(file);
  } else {
    const obj={id,title,desc,category:cat,lat,lng,photo:'',status:'Pending',votes:0,comments:[],created:Date.now()};
    const reports=loadReports(); reports.push(obj); saveReports(reports); renderAll();
    $('rTitle').value=''; $('rDesc').value=''; alert('Report submitted');
  }
});

// List Panel
function buildListPanel(){
  const panel=$('listPanel'); panel.innerHTML='<h3>All Reports</h3>';
  const all=loadReports().slice().reverse();
  all.forEach(r=>{
    const div=document.createElement('div'); div.className='card';
    div.innerHTML=`<b>${r.title}</b><div class='small'>${r.category} • ${r.status}</div>`;
    panel.appendChild(div);
  });
}

// Navigation
function setActiveNav(id){
  document.querySelectorAll('nav.bottom button').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  if(id==='navHome') $('homePanel').classList.add('active');
  else if(id==='navReport') $('reportPanel').classList.add('active');
  else if(id==='navList') $('listPanel').classList.add('active');
  else if(id==='navProfile') $('profilePanel').classList.add('active');
}
$('navHome').addEventListener('click',()=>setActiveNav('navHome'));
$('navReport').addEventListener('click',()=>setActiveNav('navReport'));
$('navList').addEventListener('click',()=>setActiveNav('navList'));
$('navProfile').addEventListener('click',()=>setActiveNav('navProfile'));

// Initial render
renderAll();
</script>
</body>
</html>

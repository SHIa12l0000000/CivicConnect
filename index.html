<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Map Prototype</title>
<!-- Google Maps JS API -->
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
  body { height: 100vh; display: flex; flex-direction: column; }
  /* Tabs */
  .tabs { display: flex; background: #007BFF; color: white; }
  .tab { flex: 1; text-align: center; padding: 12px 0; cursor: pointer; transition: 0.3s; }
  .tab:hover { background: #0056b3; }
  .tab.active { background: #0056b3; }
  /* Sections */
  .section { flex: 1; display: none; overflow: auto; }
  .section.active { display: block; }
  #map { width: 100%; height: 100%; }
  /* Theme Toggle */
  #themeToggle {
    position: absolute; top: 10px; right: 10px; z-index: 5;
    background: #fff; border: none; padding: 10px; cursor: pointer;
    border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.3);
  }
  /* Report tab */
  #reportUpload { padding: 10px; }
  #imageList { display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; }
  #imageList img { width: 100px; height: 100px; object-fit: cover; border: 1px solid #ccc; border-radius: 5px; }
  /* Floating satellite toggle */
  #mapToggle {
    position: absolute; bottom: 20px; right: 20px; z-index: 5;
    background: #007BFF; color: white; border: none; padding: 12px; border-radius: 50px;
    cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  }
</style>
</head>
<body>

<!-- Tabs -->
<div class="tabs">
  <div class="tab active" data-target="home">Home</div>
  <div class="tab" data-target="mapSection">Map</div>
  <div class="tab" data-target="report">Report</div>
</div>

<!-- Sections -->
<div id="home" class="section active">
  <h2 style="padding:10px;">Welcome to Advanced Map Prototype</h2>
  <p style="padding:10px;">Use the Map tab to see your location, switch satellite view, and search locations.</p>
</div>

<div id="mapSection" class="section">
  <button id="themeToggle">Toggle Dark Mode</button>
  <div id="map"></div>
  <button id="mapToggle">Satellite/Map</button>
</div>

<div id="report" class="section">
  <div id="reportUpload">
    <input type="file" id="imageInput" multiple>
  </div>
  <div id="imageList"></div>
</div>

<script>
/* ====== Tabs ====== */
const tabs = document.querySelectorAll('.tab');
const sections = document.querySelectorAll('.section');
tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    const target = tab.getAttribute('data-target');
    sections.forEach(s => s.classList.remove('active'));
    document.getElementById(target).classList.add('active');
  });
});

/* ====== Image Upload in Report ====== */
const imageInput = document.getElementById('imageInput');
const imageList = document.getElementById('imageList');
imageInput.addEventListener('change', (e) => {
  imageList.innerHTML = '';
  const files = e.target.files;
  Array.from(files).forEach(file => {
    const reader = new FileReader();
    reader.onload = function(ev) {
      const img = document.createElement('img');
      img.src = ev.target.result;
      imageList.appendChild(img);
    }
    reader.readAsDataURL(file);
  });
});

/* ====== Google Maps 3D + Satellite Toggle + Search + User Location ====== */
let map, mapType = 'satellite', marker, searchBox;
const themeToggle = document.getElementById('themeToggle');
const savedTheme = localStorage.getItem('theme') || 'light';
document.body.classList.add(savedTheme);

function initMap() {
  // Default location (fallback)
  const defaultLoc = { lat: 28.7041, lng: 77.1025 }; // Delhi
  map = new google.maps.Map(document.getElementById('map'), {
    center: defaultLoc,
    zoom: 17,
    mapTypeId: mapType,
    tilt: 45,
    heading: 90,
    disableDefaultUI: true,
    styles: getMapStyles(),
  });

  // Detect user location
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      const userLoc = { lat: pos.coords.latitude, lng: pos.coords.longitude };
      map.setCenter(userLoc);
      marker = new google.maps.Marker({ position: userLoc, map: map, title: 'Your Location' });
    });
  } else {
    marker = new google.maps.Marker({ position: defaultLoc, map: map, title: 'Default Location' });
  }

  // Add Search Box
  const input = document.createElement('input');
  input.type = 'text';
  input.placeholder = 'Search location';
  input.style.cssText = 'position:absolute;top:10px;left:50%;transform:translateX(-50%);padding:8px;width:60%;z-index:5;border-radius:5px;border:1px solid #ccc;';
  document.getElementById('mapSection').appendChild(input);
  searchBox = new google.maps.places.SearchBox(input);
  map.controls[google.maps.ControlPosition.TOP_CENTER].push(input);
  searchBox.addListener('places_changed', () => {
    const places = searchBox.getPlaces();
    if (!places || places.length == 0) return;
    const place = places[0];
    map.setCenter(place.geometry.location);
    map.setZoom(18);
    if (marker) marker.setMap(null);
    marker = new google.maps.Marker({ position: place.geometry.location, map: map });
  });
}

/* ====== Dark/Light Mode ====== */
function getMapStyles() {
  return document.body.classList.contains('dark') ? [
    { elementType: 'geometry', stylers: [{ color: '#212121' }] },
    { elementType: 'labels.text.fill', stylers: [{ color: '#ffffff' }] },
    { elementType: 'labels.text.stroke', stylers: [{ color: '#000000' }] },
    { featureType: 'water', elementType: 'geometry', stylers: [{ color: '#000000' }] }
  ] : [];
}

themeToggle.addEventListener('click', () => {
  const currentTheme = document.body.classList.contains('dark') ? 'dark' : 'light';
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  document.body.classList.remove(currentTheme);
  document.body.classList.add(newTheme);
  localStorage.setItem('theme', newTheme);
  map.setOptions({ styles: getMapStyles() });
});

/* ====== Satellite Toggle ====== */
const mapToggleBtn = document.getElementById('mapToggle');
mapToggleBtn.addEventListener('click', () => {
  mapType = mapType === 'satellite' ? 'roadmap' : 'satellite';
  map.setMapTypeId(mapType);
});

window.onload = initMap;
</script>

</body>
</html>
